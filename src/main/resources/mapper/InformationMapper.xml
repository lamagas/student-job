<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssm.mapper.InformationMapper">
  <resultMap id="BaseResultMap" type="com.ssm.model.Information">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="inforid" jdbcType="INTEGER" property="inforid" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="message" jdbcType="VARCHAR" property="message" />
    <result column="time" jdbcType="VARCHAR" property="time" />
    <result column="studentid" jdbcType="INTEGER" property="studentid" />
    <result column="people" jdbcType="INTEGER" property="people" />
    <result column="draft" jdbcType="INTEGER" property="draft" />
    <result column="nowpeople" jdbcType="INTEGER" property="nowpeople" />
      <collection property="student" ofType="com.ssm.model.Student">
          <id property="id" column="id"></id>
          <result property="name" column="name"/>
      </collection>
    <collection property="school" ofType="com.ssm.model.School">
      <id property="id" column="scid"></id>
      <result property="name" column="scname"/>
    </collection>
    <collection property="signUp" ofType="com.ssm.model.SignUp">
      <id property="id" column="signupid"></id>
      <result property="inforid" column="inforid"/>
      <result property="studentid" column="studentid"/>
      <result property="status" column="status"/>
    </collection>
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    inforid, title, message, time, studentid
  </sql>
  <select id="titlelist" resultType="com.ssm.model.dto.TitleDto" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    显示学生标题信息
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    i.inforid as titleId, i.title, i.time,st.name as username
    from school sc,queryschool q,information i,student st
    where  sc.name=(		SELECT
    sc.name
    FROM school sc,student st
    WHERE st.id=#{id,jdbcType=INTEGER} and sc.id=st.school) and sc.id=q.schoolid and i.inforid=q.inforid and st.id=i.studentid and i.draft=0
  </select>
  <select id="titlelist1" resultType="com.ssm.model.dto.TitleDto"  parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    显示管理员标题信息
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT
    i.inforid as titleId, i.title, i.time,st.name as username
     FROM information i,student st
    WHERE studentid=id and id=#{id,jdbcType=INTEGER} and (draft=0 or draft=1)
  </select>
  <select id="countAdmTitle" resultType="java.lang.Integer">
    SELECT count(*) FROM information,student
    WHERE studentid=id and id=#{id,jdbcType=INTEGER} and (draft=0 or draft=1)
  </select>
  <select id="countStuTitle" resultType="java.lang.Integer">
    select
    count(*)
    from school sc,queryschool q,information i,student st
    where  sc.name=(		SELECT
    sc.name
    FROM school sc,student st
    WHERE st.id=#{id,jdbcType=INTEGER} and sc.id=st.school) and sc.id=q.schoolid and i.inforid=q.inforid and st.id=i.studentid and i.draft=0
  </select>
  <select id="draft" resultMap="BaseResultMap"  parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    显示草稿
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT * FROM information,student
    WHERE studentid=id and id=#{id,jdbcType=INTEGER} and draft=2
  </select>
  <select id="recycle" resultMap="BaseResultMap"  parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    显示回收站
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    SELECT * FROM information,student
    WHERE studentid=id and id=#{id,jdbcType=INTEGER} and draft=3
  </select>
  <select id="SingUpTitle" resultMap="BaseResultMap"  parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    学生已报名信息
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    i.inforid, i.title,i.time,st.name,si.status
    from information i, sign_up si,student st
    where i.inforid =si.inforid and si.studentid=#{id,jdbcType=INTEGER} and st.id=i.studentid
  </select>
  <select id="CollectTitle" resultMap="BaseResultMap"  parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated    学生已收藏
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    i.inforid, i.title,i.time,st.name
    from information i, collect c,student st
    where i.inforid =c.c_inforid and c.c_studentid=#{id,jdbcType=INTEGER} and st.id=i.studentid
  </select>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated   显示兼职信息
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
      select
      inforid, title,message,time,studentid,name
      from information , student
    where inforid = #{inforid,jdbcType=INTEGER} and id=studentid
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from information
    where inforid = #{inforid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.ssm.model.Information" keyProperty="inforid" useGeneratedKeys="true">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into information (title, message,time, studentid,people,draft,nowpeople)
    values  (#{title,jdbcType=VARCHAR}, #{message,jdbcType=VARCHAR},#{time,jdbcType=VARCHAR}, #{studentid,jdbcType=INTEGER},#{people,jdbcType=INTEGER},#{draft,jdbcType=INTEGER},0)
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.ssm.model.Information">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update information
    set title = #{title,jdbcType=VARCHAR},
      message = #{message,jdbcType=VARCHAR}
    where inforid = #{inforid,jdbcType=INTEGER}
  </update>
  <!--draft:1为报名人数已满-->
  <update id="fabu" parameterType="java.lang.Integer">
        update information
    set draft = 0
    where inforid = #{inforid,jdbcType=INTEGER}
  </update>
  <update id="delete" parameterType="java.lang.Integer">
        update information
    set draft = 3
    where inforid = #{inforid,jdbcType=INTEGER}
  </update>
  <update id="huifu" parameterType="java.lang.Integer">
        update information
    set draft = 2
    where inforid = #{inforid,jdbcType=INTEGER}
  </update>
  <select id="peoplenum" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated   查询报名人数
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    inforid,people,nowpeople,draft
    from information
    where inforid = #{inforid,jdbcType=INTEGER}
  </select>
  <update id="updatepeoplenum" parameterType="com.ssm.model.Information">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update information
    set nowpeople = nowpeople + #{nowpeople,jdbcType=INTEGER},
    draft = #{draft,jdbcType=INTEGER}
    where inforid = #{inforid,jdbcType=INTEGER}
  </update>

  <select id="signinfor" resultType="com.ssm.model.SignUp">
    select
    *
    from sign_up
    where inforid = #{inforid,jdbcType=INTEGER}
  </select>
  <select id="studentinfor"  resultMap="stuinfor">
    select
    *
    from information
  </select>
  <resultMap id="stuinfor" type="com.ssm.model.Information">
    <id column="inforid" jdbcType="INTEGER" property="inforid" />
    <result column="title" jdbcType="VARCHAR" property="title" />
    <result column="message" jdbcType="VARCHAR" property="message" />
    <result column="time" jdbcType="VARCHAR" property="time" />
    <result column="studentid" jdbcType="INTEGER" property="studentid" />
    <result column="people" jdbcType="INTEGER" property="people" />
    <result column="draft" jdbcType="INTEGER" property="draft" />
    <result column="nowpeople" jdbcType="INTEGER" property="nowpeople" />
    <collection property="signUps" column="inforid" ofType="com.ssm.model.SignUp" select="signinfor" javaType="java.util.List"/>
  </resultMap>
  <resultMap id="stu" type="com.ssm.model.Student">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <association property="signUps" column="id" select="signinfor" javaType="java.util.List"/>
  </resultMap>
</mapper>